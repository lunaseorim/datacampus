---
title: '연습문제1 : 모수적 통계분석'
author: "Jiwon kim"
date: "`r Sys.Date()`"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```
※ 정규성 가정은 만족한다고 가정하에 문제를 해결해주세요.  ※  
```

<br/>
##1. ** 비교분석 : 내장데이터 iris 탐색-1**
  • iris 데이터셋 : 4개의 수치형변수와 1개의 factor(Species)로 구성되었고, 150행 5열로 이루어진 홍채 3종 각각에서 추출한 50개의 꽃에 관한 내장 데이터이다.
```{r}
data(iris)
head(iris)
str(iris)
nrow(iris) ; ncol(iris)
dim(iris)
```


<br/>
##1-2. ** 비교분석 : 내장데이터 iris 탐색-2**
 • iris 데이터 셋 변수 중 꽃받침 길이와 넓이, 꽃잎의 길이와 넓이는 수치형 변수, 종은 명목형 변수이다. 이 중 꽃받침의 넓이의 분포를 살펴보고자 한다.
 • 연속형 자료 -> Sepal.width : 꽃받침 넓이의 분포는 평균이 3.057이고 왼쪽으로 치우친 분포이다.
```{r}
box <- boxplot(iris$Sepal.Width, horizontal=TRUE)
box

abline(v = mean(iris$Sepal.Width), col = "red")

mode <- table(iris$Sepal.Width)[10]
abline(v = 3, col = "darkblue")
text(box$out, rep(1, NROW(box$out)), labels=box$out, pos=c(1, 1, 3, 1))
```
 
 
<br/>
##2. **일표본 T검정 (One Sample T-test)**
$$ 
\left\{
    \begin{array}{l}
      H_0 : 꽃받침의 평균너비는 5이다.(\mu_{꽃받침의너비}=5) \\
      H_1 : 꽃받침의평균너비는5보다크다.(\mu_{꽃받침의너비} > 5)
    \end{array}
  \right.
$$     
```{r}
t.test(iris$Sepal.Width, mu = 5, alter = "greater")
```

- 일표본 t검정 결과, 검정통계량 t값은 -54.587이고, 유의수준 0.05하에 유의확률은 1이므로, 귀무가설을 채택한다. <br/>
 따라서, 꽃받침의 너비는 3보다 클 수 없다고 할 수 있다.
 
 
<br/>
##3. **독립 표본(이표본) T검정 (Two Sample T-test)**
$$ 
\left\{
    \begin{array}{l}
      H_0 : 꽃받침의 너비와 꽃잎의 너비의 모분산이 동일하다. (\sigma_{꽃받침의너비}=\sigma_{꽃잎의너비}) \\
      H_1 : 꽃받침의 너비와 꽃잎의 너비의 모분산이 동일하지 않다.(\sigma_{꽃받침의너비} \neq \sigma_{꽃잎의너비})
    \end{array}
  \right.
$$     

```{r}
var.test(iris$Sepal.Width, iris$Petal.Width)   #등분산성 불만족
```

$$ 
\left\{
    \begin{array}{l}
      H_0 : 꽃받침과 꽃잎의 너비의 차이가 없다.(\mu_{꽃받침의너비} = \mu_{꽃잎의너비}) \\
      H_1 : 꽃받침의 너비는 꽃잎의 너비보다 작다.(\mu_{꽃받침의너비} < \mu_{꽃잎의너비})
    \end{array}
  \right.
$$     
```{r}
t.test(iris$Sepal.Width, iris$Petal.Width, var.equal = FALSE, alter = "less")
```

- 독립표본 t검정 결과, 검정통계량 t값은25.916이고, 유의수준 0.05하에 유의확률은 1이므로, 귀무가설을 채택한다. <br/>
 따라서, 꽃받침의 너비는 꽃잎의 너비보다 작다고 할 수 없다.

 
##4. **대응 표본 T검정 (Paired t-test)**
 - 과외를 받기 전과 받은 후의 과목 A의 성적의 차이가 있는지 알아보고자 한다.
```{r}
subject<-c(1:40)

set.seed(123); before_g <- c(sample(50:65, size = 40, replace = T))
set.seed(321); after_g <- c(sample(55:70, size = 40, replace = T))

dat <- data.frame(subject, before_g, after_g)
head(dat)
```

$$ 
\left\{
    \begin{array}{l}
      H_0 : 과외를 받기 전과 받은 후의 과목A의 성적의 차이가 없다.(\mu_D = 0) \\
      H_1 : 과외를 받기 전과 받은 후의 과목A의 성적의 차이가 있다.(\mu_D \neq 0)
    \end{array}
  \right.
$$     
```{r}
t.test(dat$after_g, dat$before_g, paired=T)
```

- 대응표본 t검정 결과, 검정통계량 t값은 5.1573이고, 유의수준 0.05하에 유의확률은 매우 작으므로, 귀무가설을 기각한다. <br/>
 따라서, 과외를 받기 전과 받은 후의 과목 A의 성적의 차이가 있다고 할 수 있다.
 

<br/> 
##5. **상관분석 (Paired t-test)**
$$ 
\left\{
    \begin{array}{l}
      H_0 : 꽃받침의 길이와 꽃잎의 넓이 간의 상관관계가 없다.(\rho_{AB} =0) \\
      H_1 : 꽃받침의 길이와 꽃잎의 넓이 간의 상관관계가 있다.(\rho_{AB} \neq 0)
    \end{array}
  \right.
$$     
```{r}
cor.test(iris$Sepal.Length, iris$Petal.Width)
```

- 상관분석 결과, 두 변수의 상관계수는 0.8179로, 강한 양의 상관관계를 가진다고 할 수 있다.


<br/>
##6. **카이제곱 검정(교차분석, Chi-Squared Analysis)**
```{r}
library(gmodels)
library(ggplot2)

data(diamonds)
head(diamonds)
```
    
    1) 독립성 검정
$$ 
\left\{
    \begin{array}{l}
      H_0 : 두 변수가 연관이 없다.(독립적이다) \\
      H_1 : 두 변수가 연관이 있다.
    \end{array}
  \right.
$$ 
    2) 동질성 검정
$$ 
\left\{
    \begin{array}{l}
      H_0 : 관측치는 집단 혹은 변수에 따른 차이가 없다. \\
      H_1 : 관측치는 집단 혹은 변수에 따른 차이가 없다.
    \end{array}
  \right.
$$ 
$$
\chi^2 = \frac{(관측값 - 기댓값)^2} {기댓값}
$$

```{r}
CrossTable(diamonds$color, diamonds$cut)
CrossTable(diamonds$color, diamonds$cut, chisq = T)

chisq.test(diamonds$color, diamonds$cut) 
```
- 교차분석 결과, 귀무가설 0.05하에 유의확률이 매우 작기 때문에 귀무가설을 기각한다. 따라서, 변수 cut과 color는 연관이 있다고 할 수 있다.


<br/>
##7. **회귀분석 : 내장데이터 faithful 탐색**
 • 내장데이터인 faithful의 변수 중 waiting을 독립변수로, eruptions를 종속변수로 설정하여 waiting에 따라 eruptions가 얼마나 영향을 끼치는지 알아보고자 한다. 
 • 상관분석 결과, waiting과 eruptions의 상관계수는 0.9008112로 매우 강한 상관관계를 가진다고 할 수 있다.
 
```{r}
data(faithful)
head(faithful)

str(faithful)

cor.test(faithful$waiting, faithful$eruptions) -> cor
```
    
    - 회귀모형의 타당성 검정
$$ 
\left\{
    \begin{array}{l}
      H_0 : 회귀모형은 타당하지 않다.(추정된 회귀직선은유의하지않다) \\
      H_1 : 회귀모형은타당하다.(추정된 회귀직선은 유의하다)
    \end{array}
  \right.
$$     

    - 회귀계수의 유의성 검정 
$$ 
\left\{
    \begin{array}{l}
      H_0 : \beta_1 = 0 (독립변수는 유의한 영향을 주지 않는다) \\
      H_1 : \beta_1 \neq 0 (독립변수는 유의한 영향을 준다)
    \end{array}
  \right.
$$     
$$ 
\left\{
    \begin{array}{l}
      H_0 : \beta_0 = 0 (기저효과가 없다) \\
      H_1 : \beta_0 \neq 0 (기저효과가 있다)
    \end{array}
  \right.
$$     

```{r}
fit <- lm(eruptions ~ waiting, data = faithful)
summary(fit)

cor$estimate^2  # 0.8115
```

-회귀분석 결과, 유의수준 0.05하에 회귀모형은 타당하다. 또한, wating의 회귀계수도 유의확률이 매우 작으므로 귀무가설을 기각한다. <br/>
 따라서, 독립변수는 유의한 영항을 준다고 할 수 있고, 회귀모형식은 eruptions = -1.874016 + 0.075628 * waiting이다. <br/>
- 결정계수는 0.8115로, 상관계수를 제곱한 값과 동일하다. 전체변화량 중 회귀직선에 의해 설명되는 변화량을 말하며 즉, 설명력이 높다고 할 수 있다.

    - 그림을 통한 잔차검정 : 선형성, 정규성, 등분산성 
```{r}
par(mfrow=c(2,2))
plot(fit)
```

```{r}
##다른 함수 사용을 통한 검정
#정규성 검정
par(mfrow = c(1,1))
library(car) 

qqPlot(fit, labels=row.names(faithful), main = "Normal Q-Q")

#선형성 검정
crPlots(fit)

#등분산성 검정
spreadLevelPlot(fit)
```

    -함수를 통한 잔차검정
```{r}
#정규성 검정
shapiro.test(fit$residuals)

#독립성 검정
car::durbinWatsonTest(fit)

#등분산성 검정
car::ncvTest(fit) 

#독립성을 제외한 나머지 가정
library(gvlma)
gvlma::gvlma(fit)
```
 

<br/>
##7. **분산분석 : 일원배치 분산분석 (One-way ANOVA)**   
- 미국의 Carlton, Now, Cambridge 라는 담배회사는 자신의 제품이 가장 타르가 적다고 주장하고 있다. 이를 실험하기 위해 각 제품당 5개의 담배를 추출하여 타르를 검사하였다. <br/>
 세 제품에 따른 타르 함량의 차이가 있는지 알아보고 차이가 있다면, 다중비교를 해보자. 모형이 적합한지 알아보자.

|제조회사|타르함량 (milligram)|
|:------:|:------:|
| Carlton | 0.16 0.14 0.21 0.14 0.13 |
| Now |	0.19 0.20 0.23 0.18 0.19 |
| Cambridge |	0.21 0.17 0.19 0.23 0.20 |

```{r}
dat2 <- data.frame (제조회사 = rep(c("Carlton", "Now", "Cambridge"), each = 5),
                    타르함량 = c(0.16, 0.14, 0.21, 0.14, 0.13, 0.19, 0.20, 0.23,
                                 0.18, 0.19, 0.21, 0.17, 0.19, 0.23, 0.20))
dat2
```

$$ 
\left\{
    \begin{array}{l}
      H_0 : 모든 그룹의 모집단의 분산이 동일하다.(\sigma_{Carlton} = \sigma_{Now} = \sigma_{Cambridge}) \\
      H_1 : 모든 그룹의 모집단의 분산이 동일하지 않다.(not H_0)
    \end{array}
  \right.
$$     
```{r}
library(lawstat)
bartlett.test(타르함량 ~ 제조회사, data = dat2)   #등분산성 만족
```


$$ 
\left\{
    \begin{array}{l}
      H_0 : 세 제품에 따른 타르함량의 차이가 없다. \\
      H_1 : not H_0 (적어도 한 제품에 따른 타르함량의 차이가 있다.)
    \end{array}
  \right.
$$     
```{r}
fit2 <- aov(타르함량 ~ 제조회사, data = dat2)
summary(fit2)
```

- 일원배치 분산분석 결과, 유의수준 0.05하에 유의확률은 0.028이기 때문에 귀무가설을 기각한다. 따라서, 적어도 한 제품에 따른 타르함량의 차이가 있다고 할 수 있다고 할 수 있다. <br/>
 처리 간의 차이가 유의하다고 판단되어 어느 제품끼리 차이가 있는지 알아보기 위해 사후검정(다중비교)을 하려고 한다. <br/>
```{r}
TukeyHSD(fit2)
plot(TukeyHSD(fit2))
```

-각 두 제품간의 사후 검정 결과, 유의 확률이 유의 수준 0.05보다 작은 집단은 Carlton-Cambridge이기 때문에 Carlton과 Cambridge 제품은 차이가 있다고 할 수 있다. (서로 다른 그룹이라고 할 수 있다.)


<br/>
##8. **분산분석 : 이원배치 분산분석 (Two-way ANOVA)**
 - 어느 공장에서 생산되는 제품의 품질에 관한 실험에서, 공장에서 사용하는 기계간의 차이와 일하는 작업자의 차이가 품질에 영향을 주는지 알아보고자 한다. 현재 사용하고 있는 기계 중에 3개를 선택하고, 기능공 가운데서 두명을 선정하여 이것으로 이루어지는 처리조합을 생성하여, 실험순서를 랜덤으로 실험하였다.

| B ~ A |	A1 | A2 |	A3 |
|:------:|:------:|:------:|:------:|
| B1 | 20, 18, 14 |	14, 18, 14 | 13, 16, 13 |
| B2 | 19, 20, 20 | 12, 12, 9	| 9, 4, 4 |

```{r}
dat3 <- data.frame(품질 = c(20, 18, 14, 14, 18, 14, 13, 16, 13, 
                            19, 20, 20, 12, 12, 9, 9, 4, 4),
                   기계 = rep(rep(c("A1", "A2", "A3"), each = 3), times = 2),
                   기능공 = rep(c("B1", "B2"), 9))
dat3

```

    1) 이 공장에서 생산되는 제품의 품질은 기계에 따라 다르다고 할 수 있는지 알아보자 : 주효과A '기계'에 대한 가설 검정
$$ 
\left\{
    \begin{array}{l}
      H_0 : 기계에 따른 제품의 품질이 차이가 없다.(\alpha_1 = \alpha_2 = \alpha_3 = 0) \\
      H_1 : not H_0 
    \end{array}
  \right.
$$     
    2) 이 공장에서 생산되는 제품의 품질은 기능공에 따라 다르다고 할 수 있는지 알아보자 : 주효과B '기능공'에 대한 가설 검정
$$ 
\left\{
    \begin{array}{l}
      H_0 : 기능공에 따른 제품의 품질이 차이가 없다.(\beta_1 = \beta_2 = 0) \\
      H_1 : not H_0 
    \end{array}
  \right.
$$     
    3) 이 공장에서 생산되는 제품의 품질에 따른 기계의 효과가 기능공에 따라 다르다고 할 수 있는지 알아보자 : 상호작용에 대한 가설 검정
$$ 
\left\{
    \begin{array}{l}
      H_0 : 기계와 기능공의 상호작용이 없다.(\alpha\beta_{ij} = 0) \\
      H_1 : not H_0 
    \end{array}
  \right.
$$     
```{r}
fit3 <- aov(dat3$품질 ~ dat3$기계 + dat3$기능공 + dat3$기계:dat3$기능공)
summary(fit3)

boxplot(품질 ~ 기계:기능공 , data = dat3)

attach(dat3)
interaction.plot(기계, 기능공, 품질, 
                 main = "Interaction Effect of machine&technician", 
                 type = "b", pch = c(19, 22), 
                 col = c("blueviolet", "red"), legend = T)
```

- 이원배치 분산분석 결과, 각 유의확률 값이 유의수준0.05 보다 작기 때문에 기계에 따른, 기능공에 따른 차이가 적어도 하나는 있다고 할 수 있고, 기계와 기능공 사이의 상호작용 역시 있다고 할 수 있다. 

```{r}
pairwise.t.test(dat3$품질, dat3$기계)
pairwise.t.test(dat3$품질, dat3$기능공)

par(mfrow=c(1,2))
plot.design(dat3$품질 ~ dat3$기계)
plot.design(dat3$품질 ~ dat3$기능공)

par(mfrow=c(1,1))
tukey = TukeyHSD(fit3)
plot(tukey)
```
